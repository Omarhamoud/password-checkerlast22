<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Strength & Suggestion</title>
  <style>
    body{font-family:Arial, sans-serif;background:#f5f5f5;margin:0}
    .wrap{max-width:520px;margin:24px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.08)}
    h1{margin:0 0 8px}
    section{margin-top:18px}
    input,button{width:100%;padding:10px;margin:8px 0;font-size:16px}
    button{background:#0ea5e9;color:#fff;border:0;border-radius:8px;cursor:pointer}
    #strength{height:10px;background:#ddd;border-radius:6px;overflow:hidden}
    #bar{height:100%;width:0;background:#ef4444;transition:width .25s}
    .result{margin-top:8px;font-size:14px}
    .row{display:flex;gap:8px}
    .row input{flex:1}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Password Analyzer</h1>

    <section>
      <h3>Test your password</h3>
      <input id="pw" type="password" placeholder="Enter password" />
      <button id="checkBtn">Check</button>
      <div id="strength"><div id="bar"></div></div>
      <div id="testResult" class="result"></div>
    </section>

    <section>
      <h3>Suggest a strong password</h3>
      <div class="row">
        <input id="name" type="text" placeholder="Your name (e.g., Ahmad)" />
        <input id="birth" type="text" placeholder="Birthdate (e.g., 2001-05-14)" />
      </div>
      <button id="suggestBtn">Suggest password</button>

      <div id="suggestBox" style="display:none">
        <div class="row">
          <input id="suggested" readonly />
          <button id="copyBtn">Copy</button>
        </div>
        <div id="suggestInfo" class="result"></div>
      </div>
    </section>
  </div>

<script>
const pw = document.getElementById('pw');
const bar = document.getElementById('bar');
const testResult = document.getElementById('testResult');

document.getElementById('checkBtn').onclick = async () => {
  const v = pw.value.trim();
  if (!v) return alert('Enter a password');
  const resp = await fetch('/.netlify/functions/check-password', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'test', password:v })
  });
  const data = await resp.json();
  bar.style.width = (data.strength_score * 25) + '%';
  bar.style.background = ['#ef4444','#f59e0b','#eab308','#22c55e','#16a34a'][data.strength_score] || '#ddd';
  let msg = `Strength: ${data.strength_score}/4`;
  if (data.pwned) msg += `<br>⚠️ Found in breaches (${data.pwned_count} times)`;
  testResult.innerHTML = msg;
};

const nameEl = document.getElementById('name');
const birthEl = document.getElementById('birth');
const suggestBox = document.getElementById('suggestBox');
const suggested = document.getElementById('suggested');
const suggestInfo = document.getElementById('suggestInfo');

document.getElementById('suggestBtn').onclick = async () => {
  const seed = (nameEl.value.trim() || '') + '|' + (birthEl.value.trim() || '');
  if (!seed.replace('|','')) return alert('Enter name and/or birthdate to seed the suggestion');
  const resp = await fetch('/.netlify/functions/check-password', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'suggest', seed, length:16, symbols:true })
  });
  const data = await resp.json();
  if (data.suggested_password) {
    suggestBox.style.display = 'block';
    suggested.value = data.suggested_password;
    suggestInfo.textContent = `Strength: ${data.suggested_password_score}/4`;
  } else {
    alert('Could not generate a suggestion, try different inputs.');
  }
};

document.getElementById('copyBtn').onclick = async () => {
  try { await navigator.clipboard.writeText(suggested.value); alert('Copied'); }
  catch { suggested.select(); document.execCommand('copy'); alert('Copied'); }
};
</script>
</body>
</html>
