<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Password Security Analyzer (Graduation Project)</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#94a3b8;--danger:#fb7185;--glass:rgba(255,255,255,0.03)}
  body{font-family:'Inter', system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#071021 0%, #081827 100%); color:#e6eef8; margin:0; padding:28px; display:flex; align-items:flex-start; justify-content:center; min-height:100vh}
  .card{width:100%;max-width:760px;background:var(--card);border-radius:12px;padding:20px 30px;box-shadow:0 6px 30px rgba(2,6,23,0.6);backdrop-filter:blur(4px)}
  h1{margin:0 0 8px;font-size:22px}
  p.lead{margin:0 0 18px;color:var(--muted)}
  label{display:block;margin-bottom:8px;color:var(--muted);font-size:13px;font-weight:600;}
  .row{display:flex;gap:12px;align-items:center}
  .input-wrapper{flex:1;position:relative}
  input[type="password"], input[type="text"]{width:100%;box-sizing:border-box;padding:12px 14px; padding-right: 45px; border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:15px}
  #togglePw{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;opacity:0.6;font-size: 20px; padding: 5px;}
  #togglePw:hover{opacity:1}
  button{background:linear-gradient(90deg,var(--accent),#34d399);border:none;padding:12px 16px;border-radius:10px;color:#042018;font-weight:600;cursor:pointer;font-family:inherit;font-size:15px;}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  button:disabled{opacity:0.5;cursor:not-allowed}
  .meta{margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chip{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;font-size:13px;color:var(--muted)}
  .result{margin-top:12px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);border:1px solid rgba(255,255,255,0.02)}
  .status-ok{color:#a7f3d0}
  .status-bad{color:#fb7185}
  .strength-bar{height:10px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden;margin-top:8px}
  .strength-fill{height:100%;width:0%;transition:width .4s ease; background:linear-gradient(90deg,#f97316,#f59e0b,#84cc16)}
  .suggestion{margin-top:12px;display:flex;gap:10px;align-items:center}
  .suggestion input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .small{font-size:13px;color:var(--muted)}
  .feedback{margin-top:10px;color:var(--muted);font-size:13px}
  .options{display:flex;gap:10px;align-items:center;margin-top:10px;}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <h1 id="title">Password Security Analyzer</h1>
    <p class="lead">Analyze password strength and check it against known data breaches.</p>

    <!-- PASSWORD INPUT -->
    <label for="pw">Password to Check</label>
    <div class="row">
      <div class="input-wrapper">
        <input id="pw" type="password" placeholder="Enter your password here..." aria-label="Password" />
        <button id="togglePw" aria-label="Show or hide password">üëÅÔ∏è</button>
      </div>
      <button id="checkBtn">Check Now</button>
    </div>

    <!-- RESULT (directly under password) -->
    <div id="result" class="result" style="display:none">
      <div id="pwnedStatus" class="small"></div>

      <div style="margin-top:10px">
        <div class="small">Strength Meter (Zxcvbn Score)</div>
        <div class="strength-bar" aria-hidden="true"><div id="strengthFill" class="strength-fill"></div></div>
        <div id="strengthText" class="small" style="margin-top:6px"></div>
      </div>

      <div id="pwnedDetails" style="margin-top:12px"></div>

      <div id="feedback" class="feedback"></div>
    </div>

    <!-- SUGGESTION SECTION (from user data) -->
    <section style="margin-top:18px">
      <h3 style="margin:0 0 8px">Suggest a strong password (from your data)</h3>
      <div class="row">
        <input id="name" type="text" placeholder="Name (e.g., Ahmad)" />
        <input id="birth" type="text" placeholder="Birthdate (e.g., 2001-05-14)" />
      </div>
      <div class="options">
        <label for="pwLength" style="margin-bottom:0;color:var(--muted);font-size:13px;font-weight:600">Suggested length:</label>
        <select id="pwLength" style="background:var(--glass);color:inherit;border:none;padding:6px;border-radius:6px;">
          <option value="8">8</option>
          <option value="12">12</option>
          <option value="16" selected>16</option>
          <option value="20">20</option>
        </select>
        <button id="suggestBtn" class="secondary">Suggest password</button>
      </div>

      <!-- Suggestion output (directly under the data inputs) -->
      <div id="suggestBox" class="result" style="display:none;margin-top:12px">
        <div class="suggestion">
          <input id="suggested" readonly />
          <button id="copyBtn">Copy</button>
        </div>
        <div id="suggestInfo" class="small" style="margin-top:8px"></div>
      </div>
    </section>

    <div class="meta" style="margin-top:18px">
      <div class="chip small">Using k-anonymity ‚Äî Your full password is never sent anywhere</div>
    </div>
  </div>

<script>
  // DOM
  const pw = document.getElementById('pw');
  const bar = document.getElementById('strengthFill');
  const testResult = document.getElementById('result');
  const pwnedStatus = document.getElementById('pwnedStatus');
  const pwnedDetails = document.getElementById('pwnedDetails');
  const strengthText = document.getElementById('strengthText');
  const feedbackEl = document.getElementById('feedback');

  const nameEl = document.getElementById('name');
  const birthEl = document.getElementById('birth');
  const suggestBox = document.getElementById('suggestBox');
  const suggested = document.getElementById('suggested');
  const suggestInfo = document.getElementById('suggestInfo');

  const checkBtn = document.getElementById('checkBtn');
  const suggestBtn = document.getElementById('suggestBtn');
  const copyBtn = document.getElementById('copyBtn');
  const pwLengthSelect = document.getElementById('pwLength');
  const togglePw = document.getElementById('togglePw');

  function setStrength(score) {
    const pct = Math.round((score / 4) * 100);
    bar.style.width = pct + '%';
    if (score < 2) {
      bar.style.background = 'linear-gradient(90deg,#ef4444,#f97316)';
    } else if (score < 4) {
      bar.style.background = 'linear-gradient(90deg,#f59e0b,#eab308,#84cc16)';
    } else {
      bar.style.background = 'linear-gradient(90deg,#84cc16,#22c55e)';
    }
    const labels = ['Very Weak','Weak','Medium','Strong','Very Strong'];
    strengthText.textContent = `Score: ${labels[score] || 'Unknown'} (${score}/4)`;
  }

  async function postJSON(body) {
    const resp = await fetch('/.netlify/functions/check-password', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if (!resp.ok) {
      const t = await resp.text();
      throw new Error('Server error: ' + t);
    }
    return resp.json();
  }

  // Check password (action 'test')
  checkBtn.addEventListener('click', async () => {
    const v = pw.value;
    if (!v) return alert('Enter a password');
    checkBtn.disabled = true;
    checkBtn.textContent = 'Checking...';
    testResult.style.display = 'none';
    feedbackEl.textContent = '';
    try {
      const data = await postJSON({ action: 'test', password: v });
      testResult.style.display = 'block';
      setStrength(data.strength_score ?? 0);
      if (data.pwned) {
        pwnedStatus.innerHTML = `<strong class="status-bad">‚ö†Ô∏è This password has been found in a data breach!</strong>`;
        pwnedDetails.innerHTML = `<div class="small">Found approximately <strong>${data.pwned_count ?? 'N/A'}</strong> times. We strongly recommend changing it.</div>`;
      } else {
        pwnedStatus.innerHTML = `<strong class="status-ok">‚úÖ This password was not found in known data breaches.</strong>`;
        pwnedDetails.innerHTML = '';
      }
      let feedbackMsg = '';
      if (data.strength_feedback && data.strength_feedback.warning) {
        feedbackMsg = data.strength_feedback.warning;
      } else if (data.strength_feedback && data.strength_feedback.suggestions && data.strength_feedback.suggestions.length > 0) {
        feedbackMsg = "Suggestions to improve: " + data.strength_feedback.suggestions.join(' - ');
      }
      feedbackEl.textContent = feedbackMsg;
    } catch (e) {
      alert('Error: ' + e.message);
    } finally {
      checkBtn.disabled = false;
      checkBtn.textContent = 'Check Now';
    }
  });

  // Suggest password (action 'suggest' using name+birth as seed)
  suggestBtn.addEventListener('click', async () => {
    const name = nameEl.value.trim();
    const birth = birthEl.value.trim();
    if (!name && !birth) return alert('Enter name and/or birthdate to seed suggestion');
    suggestBtn.disabled = true;
    suggestBtn.textContent = 'Generating...';
    suggestBox.style.display = 'none';
    suggestInfo.textContent = '';
    try {
      const seed = `${name}|${birth}`;
      const length = parseInt(pwLengthSelect.value, 10) || 16;
      const data = await postJSON({ action: 'suggest', seed, length, symbols: true });
      if (data.suggested_password) {
        suggestBox.style.display = 'block';
        suggested.value = data.suggested_password;

        // Diagnostic (no style change)
        const generatedLen = (data.suggested_password || '').length;
        const req = (typeof data.requested_length === 'number') ? data.requested_length : length;
        const used = data.used_length || length;
        suggestInfo.textContent =
          `Strength: ${data.suggested_password_score}/4 ¬∑ Requested: ${req} ¬∑ Used: ${used} ¬∑ Generated: ${generatedLen}`;
      } else {
        alert('Could not generate suggestion. Try different inputs.');
      }
    } catch (e) {
      alert('Error: ' + e.message);
    } finally {
      suggestBtn.disabled = false;
      suggestBtn.textContent = 'Suggest password';
    }
  });

  // Copy
  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(suggested.value);
      copyBtn.textContent = 'Copied!';
      setTimeout(()=>copyBtn.textContent = 'Copy', 2000);
    } catch (e) {
      alert('Copy failed: ' + e.message);
    }
  });

  // Toggle password visibility
  togglePw.addEventListener('click', () => {
    const isPassword = pw.type === 'password';
    pw.type = isPassword ? 'text' : 'password';
    togglePw.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
  });
</script>
</body>
</html>
